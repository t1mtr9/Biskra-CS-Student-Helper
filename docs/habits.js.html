<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: habits.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: habits.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ===================== HABIT TRACKER =====================
// NOTE: Your HTML uses inline onclick="showAddHabitForm()", "addNewHabit()", etc.
// To make that work reliably, we expose those functions on window. [file:1]

/**
 * The key used to store habit tracker data in localStorage.
 * @type {string}
 */
const HABIT_STORAGE_KEY = "habitTrackerData";

/**
 * Retrieves habit data from localStorage.
 * @returns {{habits: Array&lt;object>, completions: object}} The parsed habit data or a default object.
 */
function getHabitData() {
    const raw = localStorage.getItem(HABIT_STORAGE_KEY);
    return raw
        ? safeParseJSON(raw, { habits: [], completions: {} })
        : { habits: [], completions: {} };
}

/**
 * Saves habit data to localStorage.
 * @param {object} data - The habit data to save.
 */
function saveHabitData(data) {
    try {
        localStorage.setItem(HABIT_STORAGE_KEY, JSON.stringify(data));
    } catch (e) {
        console.warn("Could not save habit data", e);
    }
}

/**
 * Gets today's date in YYYY-MM-DD format.
 * @returns {string} Today's date.
 */
function getTodayDate() {
    return new Date().toISOString().split("T")[0];
}

/**
 * Shows the add habit form.
 */
function showAddHabitForm() {
    const form = document.getElementById("addHabitForm");
    const name = document.getElementById("habitName");
    if (form) form.style.display = "block";
    if (name) name.focus();
}

/**
 * Cancels adding a new habit and hides the form.
 */
function cancelAddHabit() {
    const form = document.getElementById("addHabitForm");
    const name = document.getElementById("habitName");
    const goal = document.getElementById("habitGoal");
    const cat = document.getElementById("habitCategory");

    if (form) form.style.display = "none";
    if (name) name.value = "";
    if (goal) goal.value = "1";
    if (cat) cat.value = "";
}

/**
 * Returns a random color from a predefined list.
 * @returns {string} A random color hex code.
 */
function getRandomColor() {
    const colors = ["#6ea8fe", "#31d0aa", "#ffd166", "#ff6b6b", "#9bb0d0", "#a78bfa", "#fb923c"];
    return colors[Math.floor(Math.random() * colors.length)];
}

/**
 * Adds a new habit to the list.
 */
function addNewHabit() {
    const nameEl = document.getElementById("habitName");
    const goalEl = document.getElementById("habitGoal");
    const catEl = document.getElementById("habitCategory");

    const name = (nameEl?.value || "").trim();
    const goal = parseInt(goalEl?.value, 10) || 1;
    const category = (catEl?.value || "").trim();

    if (!name) {
        alert("Please enter a habit name");
        return;
    }

    const data = getHabitData();
    const newHabit = {
        id: Date.now().toString(),
        name,
        goal,
        category: category || "General",
        createdAt: new Date().toISOString(),
        color: getRandomColor(),
    };

    data.habits.push(newHabit);
    saveHabitData(data);

    cancelAddHabit();
    renderHabits();
}

/**
 * Deletes a habit.
 * @param {string} habitId - The ID of the habit to delete.
 */
function deleteHabit(habitId) {
    if (!confirm("Are you sure you want to delete this habit?")) return;

    const data = getHabitData();
    data.habits = data.habits.filter((h) => h.id !== habitId);

    Object.keys(data.completions).forEach((date) => {
        if (data.completions[date]) delete data.completions[date][habitId];
    });

    saveHabitData(data);
    renderHabits();
}

/**
 * Toggles the completion status of a habit for today.
 * @param {string} habitId - The ID of the habit to toggle.
 */
function toggleHabitCompletion(habitId) {
    const data = getHabitData();
    const today = getTodayDate();

    if (!data.completions[today]) data.completions[today] = {};
    if (!data.completions[today][habitId]) data.completions[today][habitId] = 0;

    const habit = data.habits.find((h) => h.id === habitId);
    if (!habit) return;

    data.completions[today][habitId]++;

    if (data.completions[today][habitId] > habit.goal) {
        data.completions[today][habitId] = 0;
    }

    saveHabitData(data);
    renderHabits();
}

/**
 * Calculates the current streak for a habit.
 * @param {string} habitId - The ID of the habit.
 * @returns {number} The current streak in days.
 */
function getHabitStreak(habitId) {
    const data = getHabitData();
    const habit = data.habits.find((h) => h.id === habitId);
    if (!habit) return 0;

    let streak = 0;
    let currentDate = new Date();

    while (true) {
        const dateStr = currentDate.toISOString().split("T")[0];
        const completed = data.completions[dateStr]?.[habitId] || 0;

        if (completed >= habit.goal) {
            streak++;
            currentDate.setDate(currentDate.getDate() - 1);
        } else if (dateStr === getTodayDate()) {
            currentDate.setDate(currentDate.getDate() - 1);
        } else {
            break;
        }

        if (streak > 365) break;
    }

    return streak;
}

/**
 * Renders the list of habits.
 */
function renderHabits() {
    const data = getHabitData();
    const container = document.getElementById("habitsContainer");
    const emptyState = document.getElementById("emptyState");

    if (!container || !emptyState) return;

    const today = getTodayDate();

    if (data.habits.length === 0) {
        container.innerHTML = "";
        emptyState.style.display = "block";
        updateHabitStats();
        return;
    }

    emptyState.style.display = "none";

    const grouped = {};
    data.habits.forEach((habit) => {
        const cat = habit.category || "General";
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(habit);
    });

    let html = "";
    Object.keys(grouped).forEach((category) => {
        html += `&lt;div style="margin-bottom: 16px;">`;
        html += `&lt;div style="font-size: 12px; color: var(--muted); margin-bottom: 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">${category}&lt;/div>`;

        grouped[category].forEach((habit) => {
            const completed = data.completions[today]?.[habit.id] || 0;
            const isComplete = completed >= habit.goal;
            const streak = getHabitStreak(habit.id);
            const progress = Math.min((completed / habit.goal) * 100, 100);

            html += `
        &lt;div class="module" style="margin-bottom: 12px; ${isComplete ? "opacity: 0.85;" : ""}">
          &lt;div class="top">
            &lt;div style="display: flex; align-items: center; gap: 10px; flex: 1;">
              &lt;div style="width: 6px; height: 6px; border-radius: 50%; background: ${habit.color}; box-shadow: 0 0 8px ${habit.color};">&lt;/div>
              &lt;div class="name">${habit.name}&lt;/div>
              ${streak > 0 ? `&lt;div class="coef">ðŸ”¥ ${streak} day${streak > 1 ? "s" : ""}&lt;/div>` : ""}
            &lt;/div>
            &lt;button onclick="deleteHabit('${habit.id}')" class="secondary" style="padding: 6px 10px; font-size: 12px; opacity: 0.7;">Delete&lt;/button>
          &lt;/div>

          &lt;div style="margin-top: 12px;">
            &lt;div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              &lt;div style="font-size: 13px; color: var(--muted);">
                Progress: ${completed} / ${habit.goal}
              &lt;/div>
              &lt;div style="font-size: 13px; font-weight: 700; color: ${isComplete ? "var(--good)" : "var(--accent)"};">
                ${Math.round(progress)}%
              &lt;/div>
            &lt;/div>

            &lt;div style="height: 8px; background: var(--surface-2); border-radius: 999px; overflow: hidden;">
              &lt;div style="height: 100%; width: ${progress}%; background: ${isComplete ? "var(--good)" : "var(--accent)"
                }; transition: width 0.3s ease; box-shadow: 0 0 10px ${isComplete ? "var(--good)" : "var(--accent)"};">&lt;/div>
            &lt;/div>
          &lt;/div>

          &lt;div class="actions" style="margin-top: 12px;">
            &lt;button onclick="toggleHabitCompletion('${habit.id}')" style="flex: 1; ${isComplete ? "background: rgba(49, 208, 170, 0.20); border-color: var(--good);" : ""
                }">
              ${isComplete ? "âœ“ Completed" : "+ Mark Progress"}
            &lt;/button>
          &lt;/div>
        &lt;/div>
      `;
        });

        html += `&lt;/div>`;
    });

    container.innerHTML = html;
    updateHabitStats();
}

/**
 * Updates the habit statistics.
 */
function updateHabitStats() {
    const data = getHabitData();
    const today = getTodayDate();

    let totalCompleted = 0;
    let maxStreak = 0;

    data.habits.forEach((habit) => {
        const completed = data.completions[today]?.[habit.id] || 0;
        if (completed >= habit.goal) totalCompleted++;

        const streak = getHabitStreak(habit.id);
        if (streak > maxStreak) maxStreak = streak;
    });

    const totalEl = document.getElementById("totalHabits");
    const completedEl = document.getElementById("todayCompleted");
    const streakEl = document.getElementById("currentStreak");

    if (totalEl) totalEl.textContent = data.habits.length;
    if (completedEl) completedEl.textContent = totalCompleted;
    if (streakEl) streakEl.textContent = maxStreak;
}

// Expose habit functions for inline HTML onclick handlers
window.showAddHabitForm = showAddHabitForm;
window.cancelAddHabit = cancelAddHabit;
window.addNewHabit = addNewHabit;
window.deleteHabit = deleteHabit;
window.toggleHabitCompletion = toggleHabitCompletion;
window.renderHabits = renderHabits;

/**
 * Initializes the habits page.
 */
(function initHabits() {
    const checkAndRenderHabits = () => {
        const habitsPage = document.getElementById("pagehabits");
        if (habitsPage &amp;&amp; habitsPage.classList.contains("active")) {
            renderHabits();
        }
    };

    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => setTimeout(checkAndRenderHabits, 100));
    } else {
        setTimeout(checkAndRenderHabits, 100);
    }

    window.addEventListener("hashchange", () => setTimeout(checkAndRenderHabits, 50));
})();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ASSETS">ASSETS</a></li><li><a href="global.html#CACHE">CACHE</a></li><li><a href="global.html#HABIT_STORAGE_KEY">HABIT_STORAGE_KEY</a></li><li><a href="global.html#MARKSCALE">MARKSCALE</a></li><li><a href="global.html#MODULES">MODULES</a></li><li><a href="global.html#POMOMAXFOCUS">POMOMAXFOCUS</a></li><li><a href="global.html#QUIZ_QUESTIONS">QUIZ_QUESTIONS</a></li><li><a href="global.html#SEMESTERS">SEMESTERS</a></li><li><a href="global.html#STORAGEKEY">STORAGEKEY</a></li><li><a href="global.html#WEIGHTS">WEIGHTS</a></li><li><a href="global.html#addNewHabit">addNewHabit</a></li><li><a href="global.html#applyPomodoroSettingsFromUI">applyPomodoroSettingsFromUI</a></li><li><a href="global.html#applyTheme">applyTheme</a></li><li><a href="global.html#beep">beep</a></li><li><a href="global.html#buildModulesUI">buildModulesUI</a></li><li><a href="global.html#cancelAddHabit">cancelAddHabit</a></li><li><a href="global.html#choiceSelected">choiceSelected</a></li><li><a href="global.html#clampMark">clampMark</a></li><li><a href="global.html#clearSemesterFromStorage">clearSemesterFromStorage</a></li><li><a href="global.html#computeAndRender">computeAndRender</a></li><li><a href="global.html#currentRoute">currentRoute</a></li><li><a href="global.html#deleteHabit">deleteHabit</a></li><li><a href="global.html#el">el</a></li><li><a href="global.html#fillExample">fillExample</a></li><li><a href="global.html#formatMMSS">formatMMSS</a></li><li><a href="global.html#getHabitData">getHabitData</a></li><li><a href="global.html#getHabitStreak">getHabitStreak</a></li><li><a href="global.html#getRandomColor">getRandomColor</a></li><li><a href="global.html#getTodayDate">getTodayDate</a></li><li><a href="global.html#initPages">initPages</a></li><li><a href="global.html#initRouter">initRouter</a></li><li><a href="global.html#inputsTemplate">inputsTemplate</a></li><li><a href="global.html#isEmptyInput">isEmptyInput</a></li><li><a href="global.html#loadState">loadState</a></li><li><a href="global.html#modeBtn">modeBtn</a></li><li><a href="global.html#moduleMark">moduleMark</a></li><li><a href="global.html#nextPhaseAuto">nextPhaseAuto</a></li><li><a href="global.html#pageTemplate">pageTemplate</a></li><li><a href="global.html#persistInputValue">persistInputValue</a></li><li><a href="global.html#phaseDurationSec">phaseDurationSec</a></li><li><a href="global.html#phaseLabel">phaseLabel</a></li><li><a href="global.html#pomoInterval">pomoInterval</a></li><li><a href="global.html#pomoState">pomoState</a></li><li><a href="global.html#qEl">qEl</a></li><li><a href="global.html#quizChoose">quizChoose</a></li><li><a href="global.html#quizNext">quizNext</a></li><li><a href="global.html#quizRender">quizRender</a></li><li><a href="global.html#quizRestart">quizRestart</a></li><li><a href="global.html#quizSetBadge">quizSetBadge</a></li><li><a href="global.html#quizState">quizState</a></li><li><a href="global.html#readVal">readVal</a></li><li><a href="global.html#renderHabits">renderHabits</a></li><li><a href="global.html#renderPomo">renderPomo</a></li><li><a href="global.html#resetPomodoro">resetPomodoro</a></li><li><a href="global.html#resetUI">resetUI</a></li><li><a href="global.html#restoreAllSavedInputs">restoreAllSavedInputs</a></li><li><a href="global.html#safeParseJSON">safeParseJSON</a></li><li><a href="global.html#saveHabitData">saveHabitData</a></li><li><a href="global.html#saveState">saveState</a></li><li><a href="global.html#setActivePage">setActivePage</a></li><li><a href="global.html#setBadge">setBadge</a></li><li><a href="global.html#setWarn">setWarn</a></li><li><a href="global.html#showAddHabitForm">showAddHabitForm</a></li><li><a href="global.html#shuffleInPlace">shuffleInPlace</a></li><li><a href="global.html#skipPomodoroPhase">skipPomodoroPhase</a></li><li><a href="global.html#startTimer">startTimer</a></li><li><a href="global.html#stopTimer">stopTimer</a></li><li><a href="global.html#tick">tick</a></li><li><a href="global.html#toggleHabitCompletion">toggleHabitCompletion</a></li><li><a href="global.html#updateHabitStats">updateHabitStats</a></li><li><a href="global.html#wireMarksPersistenceForSemester">wireMarksPersistenceForSemester</a></li><li><a href="global.html#wireNotesPersistence">wireNotesPersistence</a></li><li><a href="global.html#wirePomodoro">wirePomodoro</a></li><li><a href="global.html#wireQuiz">wireQuiz</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sat Feb 07 2026 21:41:37 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
