<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pomodoro.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pomodoro.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ===================== POMODORO =====================

/**
 * The interval ID for the Pomodoro timer.
 * @type {number|null}
 */
let pomoInterval = null;

/**
 * The maximum number of focus sessions before the Pomodoro is considered done.
 * @type {number}
 */
const POMOMAXFOCUS = 5;

/**
 * The state of the Pomodoro timer.
 * @type {object}
 * @property {string} phase - The current phase of the timer (focus | short | long | done).
 * @property {number} focusDone - The number of focus sessions completed.
 * @property {number} remaining - The remaining time in seconds.
 * @property {boolean} running - Whether the timer is running.
 * @property {number} focusMin - The duration of a focus session in minutes.
 * @property {number} shortMin - The duration of a short break in minutes.
 * @property {number} longMin - The duration of a long break in minutes.
 * @property {boolean} autoNext - Whether to automatically start the next phase.
 * @property {boolean} sound - Whether to play a sound at the end of a phase.
 */
const pomoState = {
    phase: "focus", // focus | short | long | done
    focusDone: 0,
    remaining: 25 * 60,
    running: false,
    focusMin: 25,
    shortMin: 5,
    longMin: 15,
    autoNext: true,
    sound: true,
};

/**
 * A shorthand for document.getElementById.
 * @param {string} id - The ID of the element to get.
 * @returns {HTMLElement|null} The element or null if not found.
 */
function el(id) {
    return document.getElementById(id);
}

/**
 * Formats a number of seconds into MM:SS format.
 * @param {number} sec - The number of seconds.
 * @returns {string} The formatted time.
 */
function formatMMSS(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
}

/**
 * Gets the label for a given phase.
 * @param {string} phase - The phase to get the label for.
 * @returns {string} The label for the phase.
 */
function phaseLabel(phase) {
    if (phase === "focus") return "Focus";
    if (phase === "short") return "Short Rest";
    if (phase === "long") return "Long Rest";
    return "Done";
}

/**
 * Gets the duration of a phase in seconds.
 * @param {string} phase - The phase to get the duration for.
 * @returns {number} The duration of the phase in seconds.
 */
function phaseDurationSec(phase) {
    if (phase === "focus") return pomoState.focusMin * 60;
    if (phase === "short") return pomoState.shortMin * 60;
    if (phase === "long") return pomoState.longMin * 60;
    return 0;
}

/**
 * Sets the text of the Pomodoro badge.
 * @param {string} text - The text to set.
 */
function setBadge(text) {
    const b = el("pomoBadge");
    if (b) b.textContent = text;
}

/**
 * Renders the Pomodoro timer UI.
 */
function renderPomo() {
    const d = el("pomoDisplay");
    const ph = el("pomoPhase");
    const cnt = el("pomoCount");

    if (d) d.textContent = formatMMSS(pomoState.remaining);
    if (ph) ph.textContent = phaseLabel(pomoState.phase);
    if (cnt) cnt.textContent = String(pomoState.focusDone);

    const toggle = el("btnPomoToggle");
    if (toggle) toggle.textContent = pomoState.running ? "Pause" : "Start";

    setBadge(pomoState.phase === "done" ? `Finished (${POMOMAXFOCUS} focus)` : phaseLabel(pomoState.phase));
}

/**
 * Stops the Pomodoro timer.
 */
function stopTimer() {
    if (pomoInterval) clearInterval(pomoInterval);
    pomoInterval = null;
    pomoState.running = false;
    renderPomo();
}

/**
 * Plays a beep sound.
 */
function beep() {
    if (!pomoState.sound) return;
    try {
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        if (!AudioCtx) return;
        const ctx = new AudioCtx();
        const o = ctx.createOscillator();
        const g = ctx.createGain();

        o.type = "sine";
        o.frequency.value = 880;
        g.gain.value = 0.0001;

        o.connect(g);
        g.connect(ctx.destination);
        o.start();

        g.gain.exponentialRampToValueAtTime(0.15, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.30);
        o.stop(ctx.currentTime + 0.32);

        setTimeout(() => ctx.close &amp;&amp; ctx.close(), 600);
    } catch {
        /* ignore */
    }
}

/**
 * Automatically transitions to the next phase of the Pomodoro timer.
 */
function nextPhaseAuto() {
    beep();

    if (pomoState.phase === "focus") {
        pomoState.focusDone += 1;

        if (pomoState.focusDone >= POMOMAXFOCUS) {
            pomoState.phase = "done";
            pomoState.remaining = 0;
            stopTimer();
            renderPomo();
            return;
        }

        // long rest after every 4th focus session
        pomoState.phase = pomoState.focusDone % 4 === 0 ? "long" : "short";
        pomoState.remaining = phaseDurationSec(pomoState.phase);
    } else if (pomoState.phase === "short" || pomoState.phase === "long") {
        pomoState.phase = "focus";
        pomoState.remaining = phaseDurationSec("focus");
    }

    renderPomo();
    if (pomoState.autoNext) startTimer();
    else stopTimer();
}

/**
 * A single tick of the Pomodoro timer.
 */
function tick() {
    if (pomoState.remaining > 0) {
        pomoState.remaining -= 1;
        renderPomo();
        return;
    }
    nextPhaseAuto();
}

/**
 * Starts the Pomodoro timer.
 */
function startTimer() {
    if (pomoState.phase === "done") return;
    if (pomoInterval) clearInterval(pomoInterval);
    pomoState.running = true;
    pomoInterval = setInterval(tick, 1000);
    renderPomo();
}

/**
 * Applies the Pomodoro settings from the UI.
 */
function applyPomodoroSettingsFromUI() {
    const focusSelect = el("pomoFocusSelect");
    const shortInp = el("pomoShort");
    const longInp = el("pomoLong");
    const autoChk = el("pomoAuto");
    const soundChk = el("pomoSound");

    pomoState.focusMin = focusSelect ? parseInt(focusSelect.value, 10) : 25;
    pomoState.shortMin = shortInp ? Math.max(1, parseInt(shortInp.value || "5", 10)) : 5;
    pomoState.longMin = longInp ? Math.max(1, parseInt(longInp.value || "15", 10)) : 15;
    pomoState.autoNext = !!(autoChk &amp;&amp; autoChk.checked);
    pomoState.sound = !!(soundChk &amp;&amp; soundChk.checked);
}

/**
 * Resets the Pomodoro timer.
 * @param {boolean} [full=true] - Whether to do a full reset.
 */
function resetPomodoro(full = true) {
    stopTimer();
    applyPomodoroSettingsFromUI();
    pomoState.phase = "focus";
    pomoState.focusDone = 0;
    pomoState.remaining = phaseDurationSec("focus");
    if (!full) return renderPomo();
    renderPomo();
}

/**
 * Skips the current phase of the Pomodoro timer.
 */
function skipPomodoroPhase() {
    if (pomoState.phase === "done") return;
    pomoState.remaining = 0;
    renderPomo();
    nextPhaseAuto();
}

/**
 * Wires up the Pomodoro timer UI events.
 */
function wirePomodoro() {
    const btnToggle = el("btnPomoToggle");
    const btnReset = el("btnPomoReset");
    const btnSkip = el("btnPomoSkip");
    const btnHome = el("btnPomoHome");

    const focusSelect = el("pomoFocusSelect");
    const shortInp = el("pomoShort");
    const longInp = el("pomoLong");
    const autoChk = el("pomoAuto");
    const soundChk = el("pomoSound");

    const onSettingsChange = () => {
        applyPomodoroSettingsFromUI();
        if (!pomoState.running) {
            pomoState.phase = "focus";
            pomoState.focusDone = 0;
            pomoState.remaining = phaseDurationSec("focus");
            renderPomo();
        }
    };

    [focusSelect, shortInp, longInp, autoChk, soundChk].forEach((x) => {
        if (!x) return;
        x.addEventListener("change", onSettingsChange);
        x.addEventListener("input", onSettingsChange);
    });

    if (btnToggle) {
        btnToggle.onclick = () => {
            if (pomoState.running) return stopTimer();
            applyPomodoroSettingsFromUI();
            if (pomoState.remaining === 0 &amp;&amp; pomoState.phase !== "done") {
                pomoState.remaining = phaseDurationSec(pomoState.phase);
            }
            startTimer();
        };
    }
    if (btnReset) btnReset.onclick = () => resetPomodoro(true);
    if (btnSkip) btnSkip.onclick = () => skipPomodoroPhase();
    if (btnHome) btnHome.onclick = () => (location.hash = "#home");

    resetPomodoro(true);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ASSETS">ASSETS</a></li><li><a href="global.html#CACHE">CACHE</a></li><li><a href="global.html#HABIT_STORAGE_KEY">HABIT_STORAGE_KEY</a></li><li><a href="global.html#MARKSCALE">MARKSCALE</a></li><li><a href="global.html#MODULES">MODULES</a></li><li><a href="global.html#POMOMAXFOCUS">POMOMAXFOCUS</a></li><li><a href="global.html#QUIZ_QUESTIONS">QUIZ_QUESTIONS</a></li><li><a href="global.html#SEMESTERS">SEMESTERS</a></li><li><a href="global.html#STORAGEKEY">STORAGEKEY</a></li><li><a href="global.html#WEIGHTS">WEIGHTS</a></li><li><a href="global.html#addNewHabit">addNewHabit</a></li><li><a href="global.html#applyPomodoroSettingsFromUI">applyPomodoroSettingsFromUI</a></li><li><a href="global.html#applyTheme">applyTheme</a></li><li><a href="global.html#beep">beep</a></li><li><a href="global.html#buildModulesUI">buildModulesUI</a></li><li><a href="global.html#cancelAddHabit">cancelAddHabit</a></li><li><a href="global.html#choiceSelected">choiceSelected</a></li><li><a href="global.html#clampMark">clampMark</a></li><li><a href="global.html#clearSemesterFromStorage">clearSemesterFromStorage</a></li><li><a href="global.html#computeAndRender">computeAndRender</a></li><li><a href="global.html#currentRoute">currentRoute</a></li><li><a href="global.html#deleteHabit">deleteHabit</a></li><li><a href="global.html#el">el</a></li><li><a href="global.html#fillExample">fillExample</a></li><li><a href="global.html#formatMMSS">formatMMSS</a></li><li><a href="global.html#getHabitData">getHabitData</a></li><li><a href="global.html#getHabitStreak">getHabitStreak</a></li><li><a href="global.html#getRandomColor">getRandomColor</a></li><li><a href="global.html#getTodayDate">getTodayDate</a></li><li><a href="global.html#initPages">initPages</a></li><li><a href="global.html#initRouter">initRouter</a></li><li><a href="global.html#inputsTemplate">inputsTemplate</a></li><li><a href="global.html#isEmptyInput">isEmptyInput</a></li><li><a href="global.html#loadState">loadState</a></li><li><a href="global.html#modeBtn">modeBtn</a></li><li><a href="global.html#moduleMark">moduleMark</a></li><li><a href="global.html#nextPhaseAuto">nextPhaseAuto</a></li><li><a href="global.html#pageTemplate">pageTemplate</a></li><li><a href="global.html#persistInputValue">persistInputValue</a></li><li><a href="global.html#phaseDurationSec">phaseDurationSec</a></li><li><a href="global.html#phaseLabel">phaseLabel</a></li><li><a href="global.html#pomoInterval">pomoInterval</a></li><li><a href="global.html#pomoState">pomoState</a></li><li><a href="global.html#qEl">qEl</a></li><li><a href="global.html#quizChoose">quizChoose</a></li><li><a href="global.html#quizNext">quizNext</a></li><li><a href="global.html#quizRender">quizRender</a></li><li><a href="global.html#quizRestart">quizRestart</a></li><li><a href="global.html#quizSetBadge">quizSetBadge</a></li><li><a href="global.html#quizState">quizState</a></li><li><a href="global.html#readVal">readVal</a></li><li><a href="global.html#renderHabits">renderHabits</a></li><li><a href="global.html#renderPomo">renderPomo</a></li><li><a href="global.html#resetPomodoro">resetPomodoro</a></li><li><a href="global.html#resetUI">resetUI</a></li><li><a href="global.html#restoreAllSavedInputs">restoreAllSavedInputs</a></li><li><a href="global.html#safeParseJSON">safeParseJSON</a></li><li><a href="global.html#saveHabitData">saveHabitData</a></li><li><a href="global.html#saveState">saveState</a></li><li><a href="global.html#setActivePage">setActivePage</a></li><li><a href="global.html#setBadge">setBadge</a></li><li><a href="global.html#setWarn">setWarn</a></li><li><a href="global.html#showAddHabitForm">showAddHabitForm</a></li><li><a href="global.html#shuffleInPlace">shuffleInPlace</a></li><li><a href="global.html#skipPomodoroPhase">skipPomodoroPhase</a></li><li><a href="global.html#startTimer">startTimer</a></li><li><a href="global.html#stopTimer">stopTimer</a></li><li><a href="global.html#tick">tick</a></li><li><a href="global.html#toggleHabitCompletion">toggleHabitCompletion</a></li><li><a href="global.html#updateHabitStats">updateHabitStats</a></li><li><a href="global.html#wireMarksPersistenceForSemester">wireMarksPersistenceForSemester</a></li><li><a href="global.html#wireNotesPersistence">wireNotesPersistence</a></li><li><a href="global.html#wirePomodoro">wirePomodoro</a></li><li><a href="global.html#wireQuiz">wireQuiz</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sat Feb 07 2026 21:41:37 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
